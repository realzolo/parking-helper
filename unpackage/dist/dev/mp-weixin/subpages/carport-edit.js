(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subpages/carport-edit"],{163:function(e,t,r){"use strict";(function(e){r(5);n(r(3));var t=n(r(164));function n(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=r,e(t.default)}).call(this,r(1)["createPage"])},164:function(e,t,r){"use strict";r.r(t);var n=r(165),a=r(167);for(var i in a)"default"!==i&&function(e){r.d(t,e,(function(){return a[e]}))}(i);r(170);var s,u=r(11),c=Object(u["default"])(a["default"],n["render"],n["staticRenderFns"],!1,null,"5537e60f",null,!1,n["components"],s);c.options.__file="subpages/carport-edit.vue",t["default"]=c.exports},165:function(e,t,r){"use strict";r.r(t);var n=r(166);r.d(t,"render",(function(){return n["render"]})),r.d(t,"staticRenderFns",(function(){return n["staticRenderFns"]})),r.d(t,"recyclableRender",(function(){return n["recyclableRender"]})),r.d(t,"components",(function(){return n["components"]}))},166:function(e,t,r){"use strict";var n;r.r(t),r.d(t,"render",(function(){return a})),r.d(t,"staticRenderFns",(function(){return s})),r.d(t,"recyclableRender",(function(){return i})),r.d(t,"components",(function(){return n}));var a=function(){var e=this,t=e.$createElement;e._self._c},i=!1,s=[];a._withStripped=!0},167:function(e,t,r){"use strict";r.r(t);var n=r(168),a=r.n(n);for(var i in n)"default"!==i&&function(e){r.d(t,e,(function(){return n[e]}))}(i);t["default"]=a.a},168:function(e,t,r){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=u(r(25)),i=r(169),s=r(28);function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t,r,n,a,i,s){try{var u=e[i](s),c=u.value}catch(o){return void r(o)}u.done?t(c):Promise.resolve(c).then(n,a)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function s(e){c(i,n,a,s,u,"next",e)}function u(e){c(i,n,a,s,u,"throw",e)}s(void 0)}))}}var d=e.importObject("carport"),f=e.importObject("file"),l={data:function(){return{isEdit:!1,tempAddress:"",carport:{name:"",address:"",location:{},price:0,phone:"",description:"",worktime:"",total:0,images:[]},loading:!1,userId:""}},onLoad:function(e){this.init(e)},methods:{init:function(e){var t=n.getStorageSync("_user"),r=t.user_id;if(this.userId=r,e.data){var a=JSON.parse(e.data);this.isEdit=!0,this.tempAddress=a.address,this.carport={_id:a._id,name:a.name||"",address:a.address||"",location:a.location||{},price:a.price||0,phone:a.phone||"",description:a.description||"",worktime:a.worktime||"",total:a.total||0,images:a.images||[]}}},doSave:function(){var e=this;return o(a.default.mark((function t(){var r,s,u,c,o,f,l,p,m,v,h,g;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.carport,s=r.name,u=r.address,c=r.price,o=r.phone,f=r.description,l=r.worktime,p=r.total,m=r.images,!((0,i.isEmpty)(s)||(0,i.isEmpty)(u)||(0,i.isEmpty)(o)||(0,i.isEmpty)(f)||(0,i.isEmpty)(l))){t.next=4;break}return e.$notify({type:"warning",message:"请将内容填写完整!"}),t.abrupt("return");case 4:if(!(c<=0||p<0)){t.next=7;break}return e.$notify({type:"warning",message:"数据非法!"}),t.abrupt("return");case 7:return e.loading=!0,t.next=10,e.parseAddress(u);case 10:if(v=t.sent,v){t.next=15;break}return e.$notify({type:"warning",message:"无效地址，解析失败！"}),e.loading=!1,t.abrupt("return");case 15:return e.carport.location=v,e.carport.valid_address=v.province+v.city+v.district,t.next=19,e.doUpload(m);case 19:if(h=t.sent,h.forEach((function(t){e.carport.images[t.index]={url:t.url}})),!e.isEdit){t.next=27;break}return t.next=24,d.update(e.userId,e.carport);case 24:g=t.sent,t.next=30;break;case 27:return t.next=29,d.add(e.userId,e.carport);case 29:g=t.sent;case 30:if(e.loading=!1,0==g.code){t.next=34;break}return e.$notify({type:"danger",message:"发布失败!"}),t.abrupt("return");case 34:e.$notify({type:"success",message:"发布成功!"}),setTimeout((function(){n.navigateBack({delta:1})}),1500);case 36:case"end":return t.stop()}}),t)})))()},doDelete:function(){var e=this;return o(a.default.mark((function t(){var r;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,d.deleteByUserID(e.userId,e.carport._id);case 2:r=t.sent,0!=r.code?e.$notify({type:"error",message:"数据删除失败!"}):(e.$notify({type:"success",message:"删除成功!"}),setTimeout((function(){n.navigateBack({delta:1})}),1500));case 4:case"end":return t.stop()}}),t)})))()},parseAddress:function(e){var t=this;return o(a.default.mark((function r(){var n,i,u,c,o,d,f;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e!=t.tempAddress){r.next=2;break}return r.abrupt("return",t.carport.location);case 2:return r.next=4,(0,s.getCoordByAddress)(e);case 4:return n=r.sent,i=n.longitude,u=n.latitude,r.next=9,(0,s.getLocationByCoord)(i,u);case 9:return c=r.sent,o=c.province,d=c.city,f=c.district,r.abrupt("return",{longitude:i,latitude:u,province:o,city:d,district:f});case 14:case"end":return r.stop()}}),r)})))()},binding:function(e,t){this.carport[e]=t.detail},onUpload:function(e){var t=e.detail.file;this.carport.images.push({url:t.url})},doUpload:function(t){var r=this;return o(a.default.mark((function n(){var i;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=[],t.map((function(t,n){if(!t.url.startsWith("https")){var s=t.url.substring(t.url.lastIndexOf(".")),u=new Promise((function(i){e.uploadFile({filePath:t.url,cloudPath:"".concat(r.userId,"/").concat((new Date).getTime()).concat(s),success:function(){var e=o(a.default.mark((function e(t){return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,i({index:n,url:t.fileID});case 2:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()})}));i.push(u)}})),n.abrupt("return",Promise.all(i));case 3:case"end":return n.stop()}}),n)})))()},onDelete:function(e){var t=this;return o(a.default.mark((function r(){var n,i;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=e.detail.index,i=t.carport.images[n].url,t.carport.images.splice(n,1),!i.startsWith("https")){r.next=6;break}return r.next=6,f.deleteFile(i);case 6:case"end":return r.stop()}}),r)})))()}}};t.default=l}).call(this,r(39)["default"],r(1)["default"])},170:function(e,t,r){"use strict";r.r(t);var n=r(171),a=r.n(n);for(var i in n)"default"!==i&&function(e){r.d(t,e,(function(){return n[e]}))}(i);t["default"]=a.a},171:function(e,t,r){}},[[163,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../.sourcemap/mp-weixin/subpages/carport-edit.js.map